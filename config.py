"""
화장품 신제품 개발 시장 조사 분석 도구 - 설정 파일
"""
import os
import json
from dotenv import load_dotenv

# .env 파일 로드
load_dotenv()

# 프로젝트 경로
BASE_DIR = os.path.dirname(os.path.abspath(__file__))
DATA_DIR = os.path.join(BASE_DIR, "data")
EXPORTS_DIR = os.path.join(DATA_DIR, "exports")
DB_PATH = os.path.join(BASE_DIR, "database", "cosmetics_research.db")

# USP 트리거 사전 경로
DICTIONARIES_DIR = os.path.join(DATA_DIR, "dictionaries")
TRIGGER_KEYWORDS_PATH = os.path.join(DICTIONARIES_DIR, "trigger_keywords.json")
EXCLUSION_WORDS_PATH = os.path.join(DICTIONARIES_DIR, "exclusion_words.json")
CANDIDATE_KEYWORDS_PATH = os.path.join(DICTIONARIES_DIR, "candidate_keywords.json")

# 카테고리 옵션
PRODUCT_CATEGORIES = [
    "스킨케어",
    "메이크업",
    "헤어케어",
    "바디케어",
    "선케어",
    "클렌징",
    "마스크/팩",
    "립케어",
    "아이케어",
    "기타"
]

# 분류표 데이터 구조
CLASSIFICATION_SCHEMA = {
    "디자인_패키징": {
        "디자인": {
            "단상자": ["일러스트", "타이포 중심", "무지 박스"],
            "용기": ["원통", "각진", "미니 사이즈"],
            "소재": ["유광", "무광", "메탈", "소프트 터치"]
        },
        "패션결합": {
            "장착형": ["립밤+키링", "스트랩", "백참"],
            "액세서리화": ["참 장식", "체인", "컬러 파츠"]
        },
        "휴대성": {
            "파우치친화": ["납작형", "카드형"],
            "분실방지": ["스트랩", "고리"]
        }
    },
    "사용자경험": {
        "촉감": {
            "용기촉감": ["러버코팅", "실리콘", "엠보"],
            "내용물촉감": ["쫀쫀", "미끌", "탄성"]
        },
        "개폐감": {
            "소리": ["마그넷 딸깍", "캡 분리음"],
            "힘": ["원터치", "슬라이드"]
        },
        "사용방식": {
            "어플리케이터": ["롤온", "브러시", "쿠션팁"],
            "디스펜싱": ["펌프", "폼", "에어"]
        },
        "ASMR": {
            "영상요소": ["개봉 소리", "짜는 장면"]
        }
    },
    "제형": {
        "기본": {
            "크림": ["소프트", "고점도"],
            "젤": ["수분젤", "탄성젤"]
        },
        "변형": {
            "상변화": ["크림→워터"],
            "팝핑": ["알갱이 터짐"]
        },
        "시각": {
            "버블": ["거품 발생 세럼"],
            "캡슐": ["컬러 캡슐"]
        },
        "연출": {
            "가스": ["강한 버블(압축)"],
            "디스펜싱연출": ["나오는 순간 시각 효과"]
        }
    },
    "컬러": {
        "단일": ["화이트", "투명"],
        "다중": ["파스텔", "네온"],
        "기능": ["블루=쿨링", "핑크=광"],
        "반응": ["온도변색", "pH변색"],
        "시즌": ["여름 쿨톤", "겨울 웜톤"],
        "제형컬러": ["반투명", "밀키"]
    },
    "향": {
        "무향": ["완전 무향"],
        "시그니처": ["장미", "머스크"],
        "라인구분": ["데이", "나이트"],
        "잔향설계": ["오프닝→잔향"],
        "시즌향": ["여름 시트러스"],
        "사용감향": ["바를 때만 향"]
    },
    "성분": {
        "즉각체감": {
            "보습": ["히알루론산"],
            "광채": ["글리세린"]
        },
        "컨셉": ["병풀", "쌀"],
        "트렌드": ["PDRN", "엑소좀"],
        "안전성": ["저자극 포뮬러"],
        "조합": ["히알+판테놀"]
    },
    "기술": {
        "전달": {
            "리포좀": ["캡슐화"],
            "나노": ["미세입자"]
        },
        "지속": ["서방형(천천히 방출)"],
        "밀착": ["필름(피부 코팅)"],
        "안정화": ["비타민C 안정화"],
        "설명가능성": ["그림/도식 설명"]
    },
    "사용환경": {
        "시간": ["아침용", "밤용"],
        "장소": ["외출/수정용"],
        "계절": ["여름 쿨링"],
        "부위": ["눈가", "입술"],
        "상황": ["메이크업 전"]
    },
    "마케팅": {
        "바이럴": ["버블 터짐 한 컷"],
        "증거": ["보습 지속 테스트"],
        "한정": ["리미티드"],
        "메시지": ["바르면 변한다"],
        "가격구조": ["미니 버전"]
    },
    "지속가능성": {
        "리필": ["리필 카트리지"],
        "분리배출": ["캡 분리"],
        "재사용": ["케이스 재활용"],
        "규제": ["안전한 클레임"]
    }
}

# 부활 가능성 점수 레이블
REVIVAL_POTENTIAL_LABELS = {
    1: "매우 낮음",
    2: "낮음",
    3: "보통",
    4: "높음",
    5: "매우 높음"
}

# === 네이버 검색 API 설정 ===
NAVER_CLIENT_ID = os.getenv("NAVER_CLIENT_ID", "")
NAVER_CLIENT_SECRET = os.getenv("NAVER_CLIENT_SECRET", "")

# === 과거 제품 자동 발굴 설정 ===
DISCOVERY_MAX_PRODUCTS = 5  # 한 번에 최대 발굴 개수
DISCOVERY_SEARCH_DELAY = 0.2  # API 호출 간 딜레이 (초) - 네이버 제한: 초당 10회

# 화장품 카테고리 키워드 (검색 쿼리용)
COSMETIC_CATEGORY_KEYWORDS = [
    # 스킨케어
    "스킨", "토너", "에센스", "세럼", "앰플", "크림", "로션", "미스트", "오일",
    # 마스크/팩
    "마스크팩", "토너패드", "페이셜팩", "코팩", "패치",
    # 클렌징
    "클렌징폼", "클렌징젤", "클렌징오일", "클렌징밤", "클렌징워터", "클렌징밀크", "스크럽", "아이리무버",
    # 선케어
    "선크림", "선스틱", "선쿠션",
]

# 검색 쿼리 패턴 (화장품 카테고리 + 단종 관련 표현)
DISCOVERY_QUERIES = [
    # 카테고리별 단종 검색
    "크림 단종 아쉬워",
    "세럼 단종 그리워",
    "에센스 단종 다시",
    "토너 단종 재출시",
    "앰플 단종 아쉬워",
    "로션 단종 그리워",
    # 질문형 (지식인에 효과적)
    "화장품 어디서 사요 안팔아",
    "스킨케어 더이상 안나오나요",
    "크림 안파나요 단종",
    # 추억형 (블로그/카페에 효과적)
    "예전에 썼던 크림 단종",
    "추억의 스킨케어 다시",
    "옛날 세럼 단종",
]

# 알려진 화장품 브랜드 목록 (JSON 파일에서 로드)
BRANDS_JSON_PATH = os.path.join(DATA_DIR, "brands.json")

def _load_brands():
    """brands.json에서 브랜드 목록 로드"""
    try:
        with open(BRANDS_JSON_PATH, 'r', encoding='utf-8') as f:
            data = json.load(f)
            return data.get('cosmetic_brands', []), data.get('brand_aliases', {})
    except FileNotFoundError:
        # 파일이 없으면 기본 브랜드 목록 반환
        return [
            "이니스프리", "미샤", "에뛰드", "더페이스샵", "스킨푸드",
            "네이처리퍼블릭", "토니모리", "홀리카홀리카", "잇츠스킨",
        ], {}

KNOWN_COSMETIC_BRANDS, BRAND_ALIASES = _load_brands()

# 제품 유형 키워드 (제품명 추출용)
PRODUCT_TYPE_KEYWORDS = [
    "크림", "로션", "토너", "스킨", "세럼", "에센스", "앰플",
    "팩", "마스크", "오일", "젤", "밤", "스틱", "쿠션",
    "파운데이션", "립스틱", "틴트", "아이섀도우", "마스카라",
    "선크림", "클렌저", "클렌징", "폼", "미스트", "워터",
]

# === 올리브영 카테고리 통합 데이터 (Single Source of Truth) ===
# 이 데이터는 다음 3곳에서 사용되던 중복을 통합한 것입니다:
# 1. pages/1_경쟁사_상품분석.py - CATEGORY_GROUPS (UI용 대분류->소분류)
# 2. modules/oliveyoung_browser_crawler.py - CATEGORIES (크롤러용 소분류->코드)
# 3. config.py - COSMETIC_CATEGORY_KEYWORDS (검색용)

OLIVEYOUNG_CATEGORIES = {
    "스킨케어": {
        "스킨/토너": {"code": "100000100010013"},
        "에센스/세럼/앰플": {"code": "100000100010014"},
        "크림": {"code": "1000001000100150001"},
        "아이크림": {"code": "1000001000100150002"},
        "로션": {"code": "1000001000100160001"},
        "올인원": {"code": "1000001000100160002"},
        "미스트/픽서": {"code": "1000001000100100001"},
        "페이스오일": {"code": "1000001000100100002"},
        "스킨케어세트": {"code": "100000100010017"},
    },
    "마스크팩": {
        "시트팩": {"code": "1000001000900010001"},
        "패드": {"code": "1000001000900040001"},
        "페이셜팩": {"code": "100000100090002"},
        "코팩": {"code": "100000100090005"},
        "패치": {"code": "100000100090006"},
    },
    "클렌징": {
        "클렌징폼/젤": {"code": "100000100100001"},
        "클렌징오일": {"code": "1000001001000040001"},
        "클렌징밤": {"code": "1000001001000040002"},
        "클렌징워터": {"code": "1000001001000050003"},
        "클렌징밀크": {"code": "1000001001000050001"},
        "필링&스크럽": {"code": "100000100100007"},
        "클렌징티슈/패드": {"code": "100000100100008"},
        "립&아이리무버": {"code": "100000100100006"},
    },
    "선케어": {
        "선크림": {"code": "1000001001100060001"},
        "선스틱": {"code": "1000001001100030001"},
        "선쿠션": {"code": "100000100110004"},
        "선스프레이/선패치": {"code": "100000100110005"},
        "태닝": {"code": "1000001001100020001"},
        "애프터선": {"code": "1000001001100020002"},
    },
    "메이크업-립": {
        "립틴트": {"code": "1000001000200060003"},
        "립스틱": {"code": "1000001000200060004"},
        "립라이너": {"code": "1000001000200060006"},
        "립밤": {"code": "1000001000200060001"},
        "립글로스": {"code": "1000001000200060002"},
    },
    "메이크업-베이스": {
        "쿠션": {"code": "1000001000200010009"},
        "파운데이션": {"code": "1000001000200010002"},
        "블러셔": {"code": "1000001000200010006"},
        "파우더/팩트": {"code": "1000001000200010004"},
        "컨실러": {"code": "1000001000200010005"},
        "프라이머/베이스": {"code": "1000001000200010003"},
        "쉐이딩": {"code": "1000001000200010007"},
        "하이라이터": {"code": "1000001000200010008"},
        "메이크업픽서": {"code": "1000001000200010010"},
        "BB/CC": {"code": "1000001000200010001"},
    },
    "메이크업-아이": {
        "아이섀도우": {"code": "1000001000200070003"},
        "아이라이너": {"code": "1000001000200070002"},
        "마스카라": {"code": "1000001000200070001"},
        "아이브로우": {"code": "1000001000200070004"},
    },
    "뷰티소품": {
        "브러시": {"code": "1000001000600010007"},
        "퍼프": {"code": "1000001000600010005"},
        "스펀지": {"code": "1000001000600010006"},
        "화장솜": {"code": "1000001000600060001"},
        "뷰러": {"code": "1000001000600070001"},
        "속눈썹/쌍꺼풀": {"code": "1000001000600070002"},
    },
    "더모 코스메틱": {
        "더모로션/크림": {"code": "1000001000800130001"},
        "더모에센스/세럼": {"code": "1000001000800130005"},
        "더모스킨/토너": {"code": "1000001000800130002"},
        "더모아이크림": {"code": "1000001000800130004"},
    },
    "맨즈케어": {
        "맨즈올인원": {"code": "1000001000700070006"},
        "맨즈토너/로션/크림": {"code": "1000001000700070013"},
        "면도기/면도날": {"code": "1000001000700100001"},
        "애프터쉐이브": {"code": "1000001000700100005"},
    },
    "헤어케어": {
        "샴푸": {"code": "1000001000400080001"},
        "린스/컨디셔너": {"code": "1000001000400080002"},
        "헤어팩/마스크": {"code": "1000001000400070004"},
        "헤어트리트먼트": {"code": "1000001000400070005"},
        "헤어오일/세럼": {"code": "1000001000400130002"},
        "염색/새치염색": {"code": "1000001000400100007"},
        "고데기": {"code": "1000001000400040008"},
        "드라이기": {"code": "1000001000400040009"},
    },
    "바디케어": {
        "바디로션": {"code": "1000001000300140001"},
        "바디크림": {"code": "1000001000300140002"},
        "바디오일": {"code": "1000001000300140003"},
        "바디워시": {"code": "1000001000300050001"},
        "바디스크럽": {"code": "1000001000300050002"},
        "입욕제": {"code": "1000001000300050003"},
        "립케어": {"code": "100000100030008"},
        "핸드크림": {"code": "1000001000300160002"},
        "핸드워시": {"code": "1000001000300160001"},
        "바디미스트": {"code": "100000100030015"},
        "제모크림": {"code": "1000001000300190001"},
        "데오드란트": {"code": "100000100030012"},
    },
    "향수/디퓨저": {
        "여성향수": {"code": "1000001000500030001"},
        "남성향수": {"code": "1000001000500040001"},
        "유니섹스향수": {"code": "1000001000500110001"},
        "미니/고체향수": {"code": "100000100050010"},
        "홈프래그런스": {"code": "100000100050012"},
    },
    "네일": {
        "일반네일": {"code": "100000100120007"},
        "젤네일": {"code": "100000100120010"},
        "네일팁/스티커": {"code": "100000100120008"},
        "네일케어": {"code": "100000100120004"},
    },
    "건강식품": {
        "비타민": {"code": "100000200010015"},
        "유산균": {"code": "100000200010024"},
        "영양제": {"code": "100000200010025"},
        "슬리밍/이너뷰티": {"code": "100000200010023"},
    },
    "푸드": {
        "식단관리": {"code": "100000200020020"},
        "과자/초콜릿": {"code": "100000200020023"},
        "생수/음료/커피": {"code": "100000200020022"},
    },
    "구강용품": {
        "칫솔": {"code": "100000200030015"},
        "치약": {"code": "100000200030016"},
        "애프터구강케어": {"code": "100000200030017"},
    },
    "여성/위생용품": {
        "생리/위생용품": {"code": "100000200040001"},
        "Y존케어": {"code": "100000200040006"},
    },
}


def get_category_groups():
    """UI용 대분류->소분류 매핑"""
    return {
        group: list(categories.keys())
        for group, categories in OLIVEYOUNG_CATEGORIES.items()
    }


def get_category_codes():
    """크롤러용 카테고리 코드 매핑"""
    codes = {}
    for categories in OLIVEYOUNG_CATEGORIES.values():
        for name, info in categories.items():
            codes[name] = info["code"]
    return codes


def get_all_category_names():
    """모든 소분류 카테고리 이름 리스트"""
    names = []
    for categories in OLIVEYOUNG_CATEGORIES.values():
        names.extend(categories.keys())
    return names
